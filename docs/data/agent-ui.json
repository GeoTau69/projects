{
  "project": "agent-ui",
  "display_name": "Agent UI",
  "version": "2.0.0",
  "updated": "2026-02-22",
  "description": "Webov√© rozhran√≠ pro AI orchestr√°tor. Flask + HTMX, konverzace, ≈°ablony, statistiky.",
  "status": "active",
  "port": 8100,
  "tech": ["python", "flask", "htmx", "sqlite"],
  "access": {
    "local": "http://localhost:8100",
    "lan": "http://192.168.0.101:8100",
    "tailscale": "http://fedora:8100"
  },
  "back_link": {"href": "/", "label": "üè† Zpƒõt na Dashboard"},
  "modules": [
    {
      "id": "app_py",
      "name": "app.py",
      "file": "app.py",
      "purpose": "Flask server ‚Äî 450+ ≈ô√°dk≈Ø, 15 routes, orchestr√°tor integration",
      "status": "stable",
      "public_methods": [
        {
          "name": "billing_today",
          "params": "",
          "returns": "dict",
          "description": "Vr√°t√≠ billing summary pro dne≈°n√≠ den (vol√°n√≠, cache hits, tokeny, n√°klady)."
        },
        {
          "name": "memory_stats",
          "params": "",
          "returns": "dict",
          "description": "ƒåte /proc/meminfo, nvidia-smi, ollama ps ‚Äî vr√°t√≠ RAM/GPU/Ollama stats."
        },
        {
          "name": "_build_conv_messages",
          "params": "conn, cid, new_prompt, summary_id",
          "returns": "list[dict]",
          "description": "Sestav√≠ messages list pro AI z historie konverzace + nov√©ho promptu (s opcion√°ln√≠m souhrnem)."
        },
        {
          "name": "_generate_summaries",
          "params": "cid, history_text",
          "returns": "None",
          "description": "Spust√≠ 3 background vl√°kna pro generov√°n√≠ souhrn≈Ø (Qwen, DeepSeek, Haiku)."
        },
        {
          "name": "_generate_conv_name",
          "params": "cid, first_exchange",
          "returns": "None",
          "description": "Background vl√°kno ‚Äî Haiku pojmenuje konverzaci po prvn√≠ odpovƒõdi."
        }
      ],
      "dependencies": ["flask", "anthropic", "_meta (orchestrator, billing, router, conversations, plugins)"],
      "notes": "Routes vr√°t√≠ HTML (GET) nebo HTMX partials (POST). Backend selector mapuje force_backend ‚Üí orchestr√°tor."
    },
    {
      "id": "conversations_py",
      "name": "_meta/conversations.py",
      "file": "../../_meta/conversations.py",
      "purpose": "DB layer ‚Äî templates, conversations, messages, summaries",
      "status": "stable",
      "public_methods": [
        {
          "name": "template_list/create/get/update/delete",
          "params": "conn, [name, content, tid]",
          "returns": "list[dict] / int / dict / None",
          "description": "CRUD pro ≈°ablony (system prompts ulo≈æen√© v DB)."
        },
        {
          "name": "conv_list/get/create/rename/close",
          "params": "conn, [cid, name]",
          "returns": "list[dict] / dict / int / None",
          "description": "CRUD pro konverzace + message_count agregace."
        },
        {
          "name": "msg_list/last_id/save_user/save_assistant/get_unanswered",
          "params": "conn, cid, [content, model, backend, tokens]",
          "returns": "list[dict] / int / dict / None",
          "description": "Messages: ≈ôetƒõzen√≠ parent_id, ulo≈æen√≠ promptu/odpovƒõdi, detekce nezodpovƒõzen√Ωch."
        },
        {
          "name": "summary_list/save",
          "params": "conn, [cid, model, content, gen_time_ms]",
          "returns": "list[dict] / int",
          "description": "Souhrny: ulo≈æ√≠ s word_count, char_count ‚Äî poƒç√≠t√°no p≈ôi save."
        }
      ],
      "dependencies": ["sqlite3", "billing.DB_PATH"],
      "notes": "Sd√≠len√° DB s billing (~/.ai-agent/tokens.db). 4 tabulky. init_conv_db() vytvo≈ô√≠/migruje sch√©ma."
    }
  ],
  "sections": [
    {
      "id": "prehled",
      "title": "P≈ôehled",
      "icon": "üí¨",
      "blocks": [
        {
          "type": "text",
          "text": "<strong>Agent UI</strong> je webov√© rozhran√≠ pro orchestr√°tor (_meta/). Umo≈æ≈àuje konverzace s AI (s histori√≠), spr√°vu ≈°ablon (system prompts), a statistiky n√°klad≈Ø."
        },
        {
          "type": "text",
          "text": "<strong>Proƒç to m√°me:</strong> Orchestr√°tor je CLI/SDK ‚Äî pro bƒõ≈æn√© dotazy je web pohodlnƒõj≈°√≠. Konverzace s kontextem, ≈°ablony pro opakovan√© √∫koly, monitoring n√°klad≈Ø na jednom m√≠stƒõ."
        },
        {
          "type": "table",
          "headers": ["Funkce", "Popis"],
          "rows": [
            ["<strong>Request builder</strong>", "Zvol√≠≈° konverzaci, ≈°ablonu, operaci, model, backend ‚Üí ode≈°le≈°"],
            ["<strong>Konverzace</strong>", "Message history s parent-child ≈ôetƒõzen√≠m, auto-naming (Haiku), auto-closing"],
            ["<strong>≈†ablony</strong>", "System prompts v DB ‚Äî pro code review, architektura, custom tasky"],
            ["<strong>Souhrny</strong>", "Po ukonƒçen√≠: paraleln√≠ generov√°n√≠ (Qwen, DeepSeek, Haiku) ‚Äî porovn√°n√≠ model≈Ø"],
            ["<strong>Statistiky</strong>", "Billing: posledn√≠ch 50 request≈Ø, 7denn√≠ p≈ôehled, cache hit rate"],
            ["<strong>Backend selector</strong>", "Vnutit Pro (claude-code) / API / Ollama, nebo auto priorita"],
            ["<strong>Memory monitor</strong>", "RAM/GPU/Ollama live stats v hlaviƒçce + detail panel"]
          ]
        }
      ]
    },
    {
      "id": "tech-stack",
      "title": "Tech stack",
      "icon": "‚öôÔ∏è",
      "blocks": [
        {
          "type": "heading",
          "text": "Backend"
        },
        {
          "type": "list",
          "entries": [
            "<strong>Framework:</strong> Flask (Python 3.14) ‚Äî simplicity over magic",
            "<strong>Datab√°ze:</strong> SQLite <code>~/.ai-agent/tokens.db</code> (sd√≠len√° s billing)",
            "<strong>Orchestr√°tor:</strong> <code>_meta/orchestrator.py</code> + plugins (claude-code, claude-api, ollama)",
            "<strong>Threading:</strong> Background vl√°kna pro souhrny + auto-naming (daemon threads)"
          ]
        },
        {
          "type": "heading",
          "text": "Frontend"
        },
        {
          "type": "list",
          "entries": [
            "<strong>HTML/CSS:</strong> Inline v Jinja2 ≈°ablon√°ch ‚Äî dark theme, monospace, konsistentn√≠ s dashboard.py",
            "<strong>Interaktivita:</strong> HTMX 2.0.4 (CDN) ‚Äî progressive enhancement, bez JS bundleru",
            "<strong>Polling:</strong> Status (10s), Memory (15s), Summaries (5s) ‚Äî HTMX <code>hx-trigger=\"every Ns\"</code>",
            "<strong>Spinner:</strong> JavaScript detekuje backend + model, mƒõn√≠ spinner text"
          ]
        },
        {
          "type": "heading",
          "text": "Z√°vislosti"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "flask              # Web framework\nanthropologic    # Claude API backend (pro request)\nsqlite3            # Built-in ‚Äî DB\nurllib             # Built-in ‚Äî Ollama HTTP\nsubprocess         # Built-in ‚Äî nvidia-smi, ollama ps"
        }
      ]
    },
    {
      "id": "architektura",
      "title": "Architektura",
      "icon": "üèóÔ∏è",
      "blocks": [
        {
          "type": "heading",
          "text": "Datov√Ω tok"
        },
        {
          "type": "code",
          "lang": "text",
          "text": "User vypln√≠ formul√°≈ô\n   ‚Üì\nPOST /ask\n   ‚îú‚îÄ Ulo≈æ prompt do DB (msg_save_user)\n   ‚îú‚îÄ Postav messages z historie + nov√©ho promptu\n   ‚îú‚îÄ Vyber backend dle backend_force nebo auto priority\n   ‚îú‚îÄ Zavolej orchestrator.request()\n   ‚îÇ  ‚îú‚îÄ S√©mantick√° cache lookup\n   ‚îÇ  ‚îú‚îÄ Hash cache lookup (dle CACHE_TTL[operace])\n   ‚îÇ  ‚îú‚îÄ Zvolen√≠ backendu: Pro ‚Üí API ‚Üí Ollama\n   ‚îÇ  ‚îî‚îÄ Execute na zvolen√©m backendu\n   ‚îú‚îÄ Ulo≈æ odpovƒõƒè do DB (msg_save_assistant + ƒças)\n   ‚îú‚îÄ Background: Haiku pojmenuje konverzaci (pokud nov√°)\n   ‚îî‚îÄ Vr√°t√≠ response.html s badgem backendu\n   ‚Üì\nHTMX swap ‚Üí Browser zobraz√≠ odpovƒõƒè + ƒças"
        },
        {
          "type": "heading",
          "text": "Konverzace ‚Äî lifecycle"
        },
        {
          "type": "code",
          "lang": "text",
          "text": "1. Nov√° konverzace\n   ‚Üí conv_create() ‚Üí practices /ask?conv=<id>\n\n2. V√Ωbƒõr ≈°ablony (voliteln√Ω)\n   ‚Üí Prvn√≠ zpr√°va s is_template=1 ‚Üí neukazuje se v kontextu AI\n   ‚Üí Zbyl√© prompty jsou norm√°ln√≠ user messages\n\n3. Message chain\n   ‚Üí user msg 1 ‚Üí parent_id=None\n   ‚Üí assistant response 1 ‚Üí parent_id=user_msg_1.id\n   ‚Üí user msg 2 ‚Üí parent_id=response_1.id\n   ‚Üí ...≈ôetƒõzen√≠ pokraƒçuje\n\n4. Uzav≈ôen√≠ konverzace\n   ‚Üí conv_close() ‚Üí is_closed=1\n   ‚Üí Background: _generate_summaries()\n      ‚îú‚îÄ vl√°kno 1: Qwen (ollama/qwen2.5-coder:14b)\n      ‚îú‚îÄ vl√°kno 2: DeepSeek (ollama/deepseek-coder:33b)\n      ‚îî‚îÄ vl√°kno 3: Haiku (claude-haiku-4-5)\n   ‚Üí Ka≈æd√Ω souhrn se ulo≈æ√≠ s word_count, char_count, gen_time_ms\n   ‚Üí Frontend polling summaries ka≈æd√Ωch 5s\n\n5. Znovuotev≈ôen√≠ uzav≈ôen√© konverzace\n   ‚Üí V√Ωbƒõr souhrnu v ask form (haiku/qwen/deepseek)\n   ‚Üí Souhrn se p≈ôipoj√≠ jako [Kontext p≈ôedchoz√≠ konverzace]\n   ‚Üí AI vid√≠ souhrn, ne plnou historii ‚Üí √∫spora token≈Ø"
        },
        {
          "type": "heading",
          "text": "Backend priority (auto mode)"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "<strong>Cloud modely:</strong> Pro (claude-code) ‚Üí API (claude) ‚Üí Ollama (fallback)",
            "<strong>Lok√°ln√≠ modely:</strong> Ollama ‚Üí Pro/API (fallback)",
            "<strong>Explicitn√≠ ollama model:</strong> Vynucuje Ollama (raise error pokud unavailable)"
          ]
        },
        {
          "type": "heading",
          "text": "Database schema"
        },
        {
          "type": "code",
          "lang": "sql",
          "text": "templates\n  id, name, content, created_at\n\nconversations\n  id, name, created_at, closed_at, is_closed\n\nmessages\n  id, conversation_id, parent_id,\n  role (user/assistant), content, is_template,\n  model, backend, tokens_in, tokens_out, cost_usd, response_time_ms,\n  timestamp\n\nconv_summaries\n  id, conversation_id, model (qwen/deepseek/haiku),\n  content, word_count, char_count, gen_time_ms, created_at"
        }
      ]
    },
    {
      "id": "routes",
      "title": "HTTP Routes",
      "icon": "üõ£Ô∏è",
      "blocks": [
        {
          "type": "table",
          "headers": ["Route", "Method", "Vrac√≠", "Popis"],
          "rows": [
            ["<code>/</code>", "GET", "HTML", "Dashboard ‚Äî billing dnes, status backend≈Ø, memory"],
            ["<code>/status</code>", "GET", "HTMX partial", "Backend availability (polling 10s)"],
            ["<code>/memory</code>", "GET", "HTMX partial", "RAM/GPU/Ollama detail"],
            ["<code>/memory/header</code>", "GET", "HTMX partial", "Kompaktn√≠ RAM bar (polling 15s)"],
            ["<code>/stats</code>", "GET", "HTML", "Billing: posledn√≠ch 50 request≈Ø, 7d p≈ôehled, cache rate"],
            ["<code>/ask</code>", "GET", "HTML", "Request builder (<code>?conv=&lt;id&gt;</code>)"],
            ["<code>/ask</code>", "POST", "HTMX partial", "Orchestr√°tor ‚Üí response.html"],
            ["<code>/templates</code>", "GET", "HTML", "Seznam ≈°ablon"],
            ["<code>/templates/new</code>", "POST", "Redirect", "Vytvo≈ô novou ≈°ablonu"],
            ["<code>/templates/&lt;id&gt;/edit</code>", "GET/POST", "HTML / Redirect", "Editace ≈°ablony"],
            ["<code>/templates/&lt;id&gt;/delete</code>", "POST", "Redirect", "Sma≈æ ≈°ablonu"],
            ["<code>/conversations</code>", "GET", "HTML", "Seznam konverzac√≠"],
            ["<code>/conversations/new</code>", "POST", "Redirect", "Vytvo≈ô novou konverzaci"],
            ["<code>/conversations/&lt;id&gt;/messages</code>", "GET", "HTMX partial", "Historie zpr√°v"],
            ["<code>/conversations/&lt;id&gt;/close</code>", "POST", "Redirect", "Uzav≈ôi + gen. souhrny"],
            ["<code>/conversations/&lt;id&gt;/summaries</code>", "GET", "HTMX partial", "Stav souhrn≈Ø (polling)"],
            ["<code>/conversations/&lt;id&gt;/rename</code>", "POST", "Redirect", "P≈ôejmenuj konverzaci"]
          ]
        }
      ]
    },
    {
      "id": "backendy",
      "title": "Backendy (3 modely AI)",
      "icon": "ü§ñ",
      "blocks": [
        {
          "type": "heading",
          "text": "Claude Code (Pro/Max licence)"
        },
        {
          "type": "list",
          "entries": [
            "<strong>ID:</strong> <code>claude-code</code>",
            "<strong>Zdroj:</strong> Tvoje Pro/Max CLI ‚Äî <code>claude -p</code>",
            "<strong>Cena:</strong> Pau≈°√°l (Pro) ‚Äî bez dodateƒçn√Ωch n√°klad≈Ø",
            "<strong>Tokeny:</strong> Odhad (1 slovo ‚âà 1.35 tok, 1 znak ‚âà 1/3.8 tok)",
            "<strong>Timeout:</strong> 120s",
            "<strong>Dostupnost:</strong> <code>shutil.which('claude') is not None</code>"
          ]
        },
        {
          "type": "heading",
          "text": "Claude API (Anthropic pay-as-you-go)"
        },
        {
          "type": "list",
          "entries": [
            "<strong>ID:</strong> <code>claude</code>",
            "<strong>Zdroj:</strong> ANTHROPIC_API_KEY ‚Äî SDK",
            "<strong>Cena:</strong> Per token (opus $15/M out, sonnet $3/M out, haiku $0.8/M out)",
            "<strong>Tokeny:</strong> P≈ôesn√© (z API response)",
            "<strong>Timeout:</strong> Bez limitu (SDK default)",
            "<strong>Dostupnost:</strong> <code>ANTHROPIC_API_KEY</code> env var"
          ]
        },
        {
          "type": "heading",
          "text": "Ollama (lok√°ln√≠, zdarma)"
        },
        {
          "type": "list",
          "entries": [
            "<strong>ID:</strong> <code>ollama</code>",
            "<strong>Modely:</strong> qwen2.5-coder:14b (LOCAL_MODEL), deepseek-coder:33b (DEEPSEEK_MODEL)",
            "<strong>Cena:</strong> $0 ‚Äî bƒõ≈æ√≠ lok√°lnƒõ",
            "<strong>Tokeny:</strong> Odhad z eval_count",
            "<strong>Timeout:</strong> 120s (DeepSeek m≈Ø≈æe trvat d√©le ‚Üí zv√Ω≈°it na 300s?)",
            "<strong>Dostupnost:</strong> HEAD na <code>localhost:11434</code> (2s timeout)"
          ]
        },
        {
          "type": "heading",
          "text": "Backend badge v UI"
        },
        {
          "type": "table",
          "headers": ["Backend", "Barva", "Badge text"],
          "rows": [
            ["Claude Code (Pro)", "üü¢ Zelen√°", "<code>Claude Code (Pro)</code>"],
            ["Claude API", "üü° ≈Ωlut√°", "<code>Claude API (pay-as-you-go)</code>"],
            ["Ollama", "üîµ Modr√°", "<code>Ollama (lok√°ln√≠)</code>"]
          ]
        }
      ]
    },
    {
      "id": "ui-features",
      "title": "UI Features",
      "icon": "‚ú®",
      "blocks": [
        {
          "type": "heading",
          "text": "Request builder (/ask)"
        },
        {
          "type": "text",
          "text": "Zvol√≠≈°:"
        },
        {
          "type": "list",
          "entries": [
            "<strong>Konverzace (dropdown):</strong> Nov√°, nebo existuj√≠c√≠ konverzace",
            "<strong>≈†ablona (dropdown):</strong> System prompt z DB (voliteln√Ω)",
            "<strong>Operace (dropdown):</strong> doc_update (Qwen, cache 24h), code_review (Sonnet, no cache), atd.",
            "<strong>Model (dropdown):</strong> auto, sonnet, opus, haiku, qwen, deepseek",
            "<strong>Backend (dropdown):</strong> auto (Pro‚ÜíAPI‚ÜíOllama), nebo force Claude Code/API/Ollama",
            "<strong>Prompt (textarea):</strong> Tv≈Øj dotaz",
            "<strong>Unanswered prompt:</strong> Pokud konverzace m√° nezodpovƒõzen√Ω prompt, auto-naƒçte se s ‚ö†"
          ]
        },
        {
          "type": "heading",
          "text": "Spinner & kontextov√Ω text"
        },
        {
          "type": "text",
          "text": "Bƒõhem ƒçek√°n√≠ spinner zobrazuje:"
        },
        {
          "type": "list",
          "entries": [
            "<code>‚ü≥ Ollama / qwen2.5-coder:14b zpracov√°v√°‚Ä¶ (30‚Äì120s)</code> ‚Äî lok√°ln√≠ model",
            "<code>‚ü≥ Ollama / deepseek-coder:33b zpracov√°v√°‚Ä¶ (60‚Äì180s)</code> ‚Äî pomalej≈°√≠",
            "<code>‚ü≥ Claude Code (Pro) zpracov√°v√°‚Ä¶</code> ‚Äî web, rychl√©",
            "<code>‚ü≥ Claude API zpracov√°v√°‚Ä¶</code> ‚Äî cloud, rychl√©"
          ]
        },
        {
          "type": "heading",
          "text": "Odpovƒõƒè"
        },
        {
          "type": "list",
          "entries": [
            "<strong>Backend badge:</strong> Barevn√Ω tag (Pro/API/Ollama)",
            "<strong>Tokeny:</strong> in/out (u Claude Code: <code>(odhad)</code>)",
            "<strong>Cena:</strong> USD (u Claude Code: <code>(orient.)</code>)",
            "<strong>Cache hit:</strong> ‚ö° pokud cache",
            "<strong>ƒåas:</strong> ms odpovƒõdi"
          ]
        },
        {
          "type": "heading",
          "text": "Memory bar"
        },
        {
          "type": "list",
          "entries": [
            "<strong>Hlaviƒçka:</strong> Kompaktn√≠ RAM bar (color-coded: zelen√° &lt;60%, ≈ælut√° 60‚Äì85%, ƒçerven√° &gt;85%)",
            "<strong>Refresh:</strong> 15s (HTMX polling)",
            "<strong>Detail panel:</strong> RAM GB, GPU VRAM (nvidia-smi), loaded Ollama models (ollama ps)"
          ]
        }
      ]
    },
    {
      "id": "databaze",
      "title": "Datab√°ze",
      "icon": "üíæ",
      "blocks": [
        {
          "type": "heading",
          "text": "SQLite schema"
        },
        {
          "type": "text",
          "text": "Sd√≠len√° s billing: <code>~/.ai-agent/tokens.db</code>"
        },
        {
          "type": "heading",
          "text": "templates"
        },
        {
          "type": "code",
          "lang": "sql",
          "text": "id         INTEGER PRIMARY KEY\nname       VARCHAR(100) NOT NULL\ncontent    TEXT NOT NULL\ncreated_at DATETIME DEFAULT CURRENT_TIMESTAMP"
        },
        {
          "type": "text",
          "text": "<strong>√öƒçel:</strong> System prompts (pravidla pro AI). P≈ô√≠klady: \"Jsi expert na Python\", \"Code review checks\", \"Generuj boilerplate\"."
        },
        {
          "type": "heading",
          "text": "conversations"
        },
        {
          "type": "code",
          "lang": "sql",
          "text": "id         INTEGER PRIMARY KEY\nname       VARCHAR(200)          ‚Äî auto-generated by Haiku\ncreated_at DATETIME\nclosed_at  DATETIME              ‚Äî NULL pokud aktivn√≠\nis_closed  INTEGER DEFAULT 0"
        },
        {
          "type": "text",
          "text": "<strong>√öƒçel:</strong> Kontejner pro messages. Jm√©no se generuje po prvn√≠ odpovƒõdi. Uzav≈ôen√≠ spust√≠ summaries."
        },
        {
          "type": "heading",
          "text": "messages"
        },
        {
          "type": "code",
          "lang": "sql",
          "text": "id               INTEGER PRIMARY KEY\nconversation_id  INTEGER REFERENCES conversations(id)\nparent_id        INTEGER REFERENCES messages(id)  ‚Äî ≈ôetƒõzen√≠\nrole             VARCHAR(20): 'user' | 'assistant'\ncontent          TEXT\nis_template      INTEGER: 1 = ≈°ablona, 0 = norm√°ln√≠ zpr√°va\nmodel            VARCHAR(50)        ‚Äî kter√Ω model odpovƒõdƒõl\nbackend          VARCHAR(30)        ‚Äî 'claude-code' | 'claude' | 'ollama'\ntokens_in        INTEGER            ‚Äî input tokens\ntokens_out       INTEGER            ‚Äî output tokens\ncost_usd         DECIMAL            ‚Äî jen u placen√Ωch\nresponse_time_ms INTEGER            ‚Äî ms na odpovƒõƒè\ntimestamp        DATETIME"
        },
        {
          "type": "text",
          "text": "<strong>√öƒçel:</strong> Jednotliv√© zpr√°vy v konverzaci. Parent_id tvo≈ô√≠ ≈ôetƒõzec: user‚Üíassistant‚Üíuser‚Üí..."
        },
        {
          "type": "heading",
          "text": "conv_summaries"
        },
        {
          "type": "code",
          "lang": "sql",
          "text": "id               INTEGER PRIMARY KEY\nconversation_id  INTEGER REFERENCES conversations(id)\nmodel            VARCHAR(50)        ‚Äî 'qwen' | 'deepseek' | 'haiku'\ncontent          TEXT               ‚Äî samotn√Ω souhrn (max 200 slov)\nword_count       INTEGER            ‚Äî poƒçet slov v souhrnu\nchar_count       INTEGER            ‚Äî poƒçet znak≈Ø\ngen_time_ms      INTEGER            ‚Äî jak dlouho trvala generace\ncreated_at       DATETIME"
        },
        {
          "type": "text",
          "text": "<strong>√öƒçel:</strong> Kontextov√© souhrny uzav≈ôen√Ωch konverzac√≠. Umo≈æ≈àuje porovn√°n√≠: kter√Ω model vygeneruje nejlep≈°√≠ souhrn za nejkrat≈°√≠ ƒças?"
        }
      ]
    },
    {
      "id": "spusteni-instalace",
      "title": "Spu≈°tƒõn√≠ & Instalace",
      "icon": "‚å®Ô∏è",
      "blocks": [
        {
          "type": "heading",
          "text": "P≈ôedpoklady"
        },
        {
          "type": "list",
          "entries": [
            "<strong>Python 3.14+</strong> ‚Äî stdlib",
            "<strong>Flask</strong> ‚Äî <code>pip install flask</code>",
            "<strong>Anthropic SDK</strong> ‚Äî <code>pip install anthropic</code> (pro Claude API backend)",
            "<strong>ANTHROPIC_API_KEY</strong> ‚Äî env var (pro Claude API backend)",
            "<strong>Ollama</strong> ‚Äî <code>ollama serve</code> bƒõ≈æ√≠c√≠ na localhost:11434 (pro Ollama backend)"
          ]
        },
        {
          "type": "heading",
          "text": "Instalace & spu≈°tƒõn√≠"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "cd /home/geo/projects/agent-ui\n\n# Nainstaluj z√°vislosti\npip install -r requirements.txt\n\n# Nastav API kl√≠ƒç\nexport ANTHROPIC_API_KEY=sk-ant-...\n\n# Spus≈• server\npython3 app.py\n# Output: Agent UI: http://localhost:8100/"
        },
        {
          "type": "heading",
          "text": "Systemd (user service)"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "systemctl --user status agent-ui\nsystemctl --user start agent-ui\nsystemctl --user restart agent-ui\nsystemctl --user stop agent-ui\njournalctl --user -u agent-ui -f"
        },
        {
          "type": "heading",
          "text": "Checks"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "# Server live?\ncurl http://localhost:8100/\n\n# Backend dostupn√Ω?\ncurl http://localhost:8100/status | grep -i available\n\n# Datab√°ze?\nsqlite3 ~/.ai-agent/tokens.db '.tables'\n\n# Ollama?\ncurl http://localhost:11434/api/tags"
        }
      ]
    },
    {
      "id": "workflow",
      "title": "Workflow & Use cases",
      "icon": "üéØ",
      "blocks": [
        {
          "type": "heading",
          "text": "Nov√° konverzace"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "Klikni: <strong>Nov√° konverzace</strong> ‚Üí nov√° ≈ô√°dka v DB, redirect /ask?conv=X",
            "Vyber (volitelnƒõ) <strong>≈†ablonu</strong> ‚Üí prvn√≠ zpr√°va bude ≈°ablona (is_template=1)",
            "Napi≈° <strong>Prompt</strong> ‚Üí vlo≈æ sv≈Øj dotaz",
            "Vyber <strong>Backend</strong> (auto / Claude Code / API / Ollama)",
            "Klikni <strong>Odeslat</strong> ‚Üí prompt se ulo≈æ√≠ do DB, AI zpracuje, odpovƒõƒè se ulo≈æ√≠"
        ]
        },
        {
          "type": "heading",
          "text": "Pokraƒçov√°n√≠ konverzace"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "Vyber konverzaci v dropdown ‚Üí historie se naƒçte",
            "Napi≈° dal≈°√≠ prompt",
            "Odeslat ‚Üí nov√Ω prompt se ulo≈æ√≠, history (vƒçetnƒõ ≈°ablony) se po≈°le AI",
            "AI vr√°t√≠ odpovƒõƒè ‚Üí reply se ulo≈æ√≠ s parent_id = tv≈Øj_prompt.id"
          ]
        },
        {
          "type": "heading",
          "text": "Uzav≈ôen√≠ konverzace"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "Konverzace se ulo≈æ√≠ jako is_closed=1",
            "Background: 3 vl√°kna generuj√≠ souhrny (Qwen, DeepSeek, Haiku) paralelnƒõ",
            "Frontend polling summaries ka≈æd√Ωch 5s ‚Äî vid√≠≈° stav ‚úì/‚ü≥",
            "Jakmile v≈°echny hotovy, vid√≠≈°: <code>‚úì qwen (123sl/456zn/1234ms)</code>"
        ]
        },
        {
          "type": "heading",
          "text": "Znovuotev≈ôen√≠ uzav≈ôen√© konverzace"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "Vyber konverzaci v dropdown (ikona ‚úï oznaƒçuje uzav≈ôenou)",
            "Vlo≈æ nov√Ω prompt",
            "Vybrat <strong>Kontext (souhrn)</strong> ‚Äî haiku/qwen/deepseek + word/char count",
            "Odeslat ‚Üí AI vid√≠ souhrn m√≠sto pln√© historii ‚Üí √∫spora token≈Ø"
        ]
        },
        {
          "type": "heading",
          "text": "≈†ablony"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "P≈ôejdi na <strong>≈†ablony</strong> ‚Üí seznam",
            "<strong>P≈ôidej novou:</strong> N√°zev + obsah (system prompt)",
            "<strong>Edituj / Sma≈æ</strong> existuj√≠c√≠",
            "V Ask: vyber ≈°ablonu ‚Üí stane se system promptem (ƒçi prvn√≠ zpr√°vou v konverzaci)"
          ]
        },
        {
          "type": "heading",
          "text": "Monitorov√°n√≠"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "<strong>Dashboard:</strong> Backend status (Pro/API/Ollama), memory, billing dnes",
            "<strong>Statistiky:</strong> Posledn√≠ch 50 request≈Ø, 7d p≈ôehled, cache hit %",
            "<strong>Memory bar:</strong> RAM/GPU live ‚Äî refresh 15s"
          ]
        }
      ]
    },
    {
      "id": "faq",
      "title": "FAQ",
      "icon": "‚ùì",
      "blocks": [
        {
          "type": "heading",
          "text": "Jak√Ω je rozd√≠l mezi operacemi?"
        },
        {
          "type": "text",
          "text": "Operace ≈ô√≠d√≠ routing + cache. P≈ô√≠klady:"
        },
        {
          "type": "list",
          "entries": [
            "<code>doc_update</code> ‚Üí Qwen (lok√°ln√≠) + cache 24h",
            "<code>code_review</code> ‚Üí Sonnet + bez cache",
            "<code>architecture</code> ‚Üí Opus + bez cache",
            "<code>deepseek</code> ‚Üí DeepSeek Ollama + bez cache"
          ]
        },
        {
          "type": "heading",
          "text": "Proƒç by mƒõ zaj√≠maly souhrny (summaries)?"
        },
        {
          "type": "text",
          "text": "Po uzav≈ôen√≠ konverzace si m≈Ø≈æe≈° koukat, kter√Ω model (Qwen/DeepSeek/Haiku) nejl√©pe shrnul diskuzi. Metrika: word_count, char_count, gen_time_ms. Urƒç√≠, kter√Ω model je nejoptim√°lnƒõj≈°√≠ pro tv≈Øj use case."
        },
        {
          "type": "heading",
          "text": "Jak zn√°m, kolik mƒõ stoj√≠ ta konverzace?"
        },
        {
          "type": "text",
          "text": "V <strong>Statistiky</strong> / /stats vid√≠≈° tabulku s posledn√≠ch 50 request≈Ø ‚Äî model, tokeny, cena. Summaries jsou zdarma (Qwen/DeepSeek) nebo u≈æ zaplaceny (Haiku v Pro)."
        },
        {
          "type": "heading",
          "text": "Mohu b√Ωt offline?"
        },
        {
          "type": "text",
          "text": "Pokud je Ollama bƒõ≈æ√≠c√≠ (qwen + deepseek) a Claude Code dostupn√Ω, ano. Claude API bez internetov√©ho p≈ôipojen√≠ nejde."
        },
        {
          "type": "heading",
          "text": "Timeout je p≈ô√≠li≈° kr√°tk√Ω / dlouh√Ω"
        },
        {
          "type": "text",
          "text": "Default: Ollama 120s, Claude Code 120s. DeepSeek 33B m≈Ø≈æe trvat d√©le ‚Üí zv√Ω≈°it na 300s v <code>_meta/plugins/ollama.py</code>. UI spinner zmƒõn√≠ text, aby vidƒõl, co se dƒõje."
        }
      ]
    }
  ]
}
