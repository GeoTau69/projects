{
  "project": "docs",
  "display_name": "Projects Documentation Server",
  "version": "1.0.0",
  "updated": "2026-02-22",
  "description": "Centr√°ln√≠ dokumentaƒçn√≠ web pro ~/projects/. Single-page app zobrazuj√≠c√≠ strukturu projekt≈Ø a obsah CLAUDE.md soubor≈Ø.",
  "status": "active",
  "port": 8080,
  "tech": ["python", "stdlib", "jinja2", "marked.js"],
  "back_link": {
    "href": "/",
    "label": "üè† Zpƒõt na Index"
  },
  "access": {
    "local": "http://localhost:8080",
    "lan": "http://192.168.0.101:8080",
    "tailscale": "http://fedora:8080"
  },
  "modules": [
    {
      "id": "docserver",
      "name": "docserver.py",
      "file": "docserver.py",
      "purpose": "HTTP server pro dokumentaƒçn√≠ SPA ‚Äî discovery projekt≈Ø, API endpointy, live port monitoring.",
      "status": "stable",
      "public_methods": [
        {
          "name": "load_projects",
          "description": "Naƒçte v≈°echny projekty z project.yaml soubor≈Ø v ROOT adres√°≈ôi."
        },
        {
          "name": "check_port",
          "params": "host: str, port: int",
          "returns": "bool",
          "description": "Ovƒõ≈ô√≠ zda je port dostupn√Ω (pro live status ikony v UI)."
        },
        {
          "name": "api_projects",
          "returns": "dict",
          "description": "JSON seznam projekt≈Ø s live statusem port≈Ø ‚Äî obsluhuje GET /api/projects."
        },
        {
          "name": "api_md",
          "params": "dir: str",
          "returns": "str",
          "description": "Raw markdown obsah CLAUDE.md ‚Äî obsluhuje GET /api/md?dir=X."
        }
      ],
      "dependencies": [],
      "notes": "Single-file aplikace bez z√°vislost√≠ mimo stdlib. Path traversal check: candidate.resolve().parent == ROOT.resolve()"
    },
    {
      "id": "build",
      "name": "build.py",
      "file": "build.py",
      "purpose": "JSON ‚Üí HTML renderer p≈ôes Jinja2. AI generuje pouze JSON, build.py renderuje HTML bez √∫ƒçasti AI.",
      "status": "stable",
      "public_methods": [
        {
          "name": "load_json",
          "params": "project: str",
          "returns": "dict",
          "description": "Naƒçte docs/data/{project}.json soubor."
        },
        {
          "name": "validate_schema",
          "params": "data: dict",
          "returns": "bool",
          "description": "Validuje JSON proti doc_schema.json pomoc√≠ jsonschema modulu."
        },
        {
          "name": "compute_hash",
          "params": "data: dict",
          "returns": "str",
          "description": "Vypoƒç√≠t√° MD5 hash pro detekci zmƒõn ‚Äî optimalizace, renderuj jen zmƒõnƒõn√© projekty."
        },
        {
          "name": "render_html",
          "params": "data: dict",
          "returns": "str",
          "description": "Renderuje HTML p≈ôes Jinja2 ≈°ablonu project.html.j2."
        }
      ],
      "dependencies": [],
      "notes": "Z√°vislost: jinja2 (povinn√°), jsonschema (voliteln√° pro --check). Intern√≠ hash cache v .build-state.json"
    }
  ],
  "sections": [
    {
      "id": "pristup",
      "title": "P≈ô√≠stupy",
      "icon": "üåê",
      "blocks": [
        {
          "type": "table",
          "headers": ["S√≠≈•", "URL"],
          "rows": [
            ["Lok√°ln√≠", "http://localhost:8080"],
            ["LAN", "http://192.168.0.101:8080"],
            ["Tailscale", "http://fedora:8080 ¬∑ http://100.117.55.88:8080"]
          ]
        }
      ]
    },
    {
      "id": "tech-stack",
      "title": "Tech Stack",
      "icon": "üõ†Ô∏è",
      "blocks": [
        {
          "type": "list",
          "entries": [
            "<strong>Backend:</strong> Python stdlib <code>http.server</code> (≈æ√°dn√© z√°vislosti mimo jinja2)",
            "<strong>Frontend:</strong> Inline HTML/CSS/JS (dark theme, monospace), marked.js CDN pro MD rendering",
            "<strong>Discovery:</strong> Stejn√° logika jako <code>info-sync.py</code> ‚Äî proch√°z√≠ <code>project.yaml</code> soubory"
          ]
        }
      ]
    },
    {
      "id": "soubory",
      "title": "Soubory",
      "icon": "üìÅ",
      "blocks": [
        {
          "type": "code",
          "lang": "txt",
          "text": "docserver.py          ‚Äî SPA web (CLAUDE.md viewer), port 8080\nbuild.py              ‚Äî JSON ‚Üí HTML renderer (Jinja2, bez AI), CLI tool\nproject.yaml          ‚Äî metadata projektu\nCLAUDE.md             ‚Äî tato dokumentace\n\nschema/\n  doc_schema.json     ‚Äî JSON Schema pro validaci AI-generovan√Ωch dat\n\ntemplates/\n  project.html.j2     ‚Äî Jinja2 ≈°ablona pro projektovou dokumentaci\n\ndata/\n  {projekt}.json      ‚Äî AI generuje POUZE tyto soubory\n  _test.json          ‚Äî testovac√≠/uk√°zkov√Ω soubor\n\noutput/               ‚Äî generovan√© HTML soubory (build.py output, nen√≠ verzov√°no)\n.build-state.json     ‚Äî hash cache pro detekci zmƒõn (nen√≠ verzov√°no)"
        }
      ]
    },
    {
      "id": "http-endpointy",
      "title": "HTTP Endpointy",
      "icon": "üîå",
      "blocks": [
        {
          "type": "table",
          "headers": ["Endpoint", "Obsah"],
          "rows": [
            ["<code>GET /</code>", "HTML shell (SPA)"],
            ["<code>GET /api/projects</code>", "JSON: seznam projekt≈Ø s live statusem port≈Ø"],
            ["<code>GET /api/md?dir=master</code>", "Raw markdown: ~/projects/CLAUDE.md"],
            ["<code>GET /api/md?dir=X</code>", "Raw markdown: ~/projects/X/CLAUDE.md"],
            ["<code>GET /docs/{projekt}</code>", "HTML dokumentace pro projekt (z docs/output/)"]
          ]
        }
      ]
    },
    {
      "id": "prikazy",
      "title": "P≈ô√≠kazy",
      "icon": "‚å®Ô∏è",
      "blocks": [
        {
          "type": "heading",
          "text": "Manu√°ln√≠ spu≈°tƒõn√≠ (v√Ωvojov√Ω m√≥d)"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "python3 ~/projects/docs/docserver.py"
        },
        {
          "type": "heading",
          "text": "Systemd user service"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "systemctl --user status docs\nsystemctl --user start docs\nsystemctl --user restart docs\njournalctl --user -u docs -f"
        },
        {
          "type": "heading",
          "text": "Build pipeline (Jinja2 rendering)"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "cd ~/projects/docs\npython3 build.py                              # v≈°echny projekty\npython3 build.py --project backup-dashboard   # jen jeden projekt\npython3 build.py --check                      # jen validace JSON sch√©matu\npython3 build.py --force                      # ignoruj hash cache, rebuilduj\npython3 build.py --output /cesta/soubor.html  # vlastn√≠ v√Ωstup (migrace)"
        }
      ]
    },
    {
      "id": "architektura",
      "title": "Architektura",
      "icon": "üèóÔ∏è",
      "blocks": [
        {
          "type": "list",
          "entries": [
            "<code>load_projects()</code> ‚Äî discovery p≈ôes <code>project.yaml</code>, minimalistick√Ω YAML parser (bez yaml modulu)",
            "<code>check_port()</code> ‚Äî live status portu pro sidebar ikony",
            "<code>api_projects()</code> ‚Üí JSON s projekty + live statusem",
            "<code>api_md(dir)</code> ‚Üí raw MD text (ochrana path traversal: jen p≈ô√≠m√© podadres√°≈ôe ROOT)",
            "<code>DocsHandler</code> ‚Äî routing: <code>/</code>, <code>/api/projects</code>, <code>/api/md</code>"
          ]
        }
      ]
    },
    {
      "id": "bezpecnost",
      "title": "Bezpeƒçnost",
      "icon": "üîí",
      "blocks": [
        {
          "type": "list",
          "entries": [
            "<strong>Path traversal:</strong> <code>candidate.resolve().parent == ROOT.resolve()</code> ‚Äî odm√≠tne <code>../../etc/passwd</code>",
            "<strong>≈Ω√°dn√© subprocess vol√°n√≠,</strong> ≈æ√°dn√© privilegovan√© operace",
            "<strong>XSS:</strong> HTML v JSON je trusted ‚Äî jen CLAUDE.md data, ne user input"
          ]
        }
      ]
    },
    {
      "id": "build-py-pipeline",
      "title": "build.py ‚Äî JSON ‚Üí HTML Pipeline",
      "icon": "üî®",
      "blocks": [
        {
          "type": "text",
          "text": "AI generuje <code>data/{projekt}.json</code> ‚Üí <code>build.py</code> renderuje HTML p≈ôes Jinja2 (bez AI)."
        },
        {
          "type": "heading",
          "text": "Princip ‚Äî inkrement√°ln√≠ build"
        },
        {
          "type": "list",
          "entries": [
            "Naƒçti <code>docs/data/{projekt}.json</code>",
            "Validuj proti <code>schema/doc_schema.json</code>",
            "Vypoƒç√≠tej MD5 hash",
            "Je v cache? Beze-zmƒõn? ‚Üí SKIP",
            "Jinak: vyrenderuj Jinja2 ‚Üí HTML",
            "Ulo≈æ hash do <code>.build-state.json</code>"
          ]
        },
        {
          "type": "text",
          "text": "<strong>Kl√≠ƒçov√© pravidlo:</strong> Pole pro seznam polo≈æek v JSON bloc√≠ch = <code>entries</code> (nikoli <code>items</code> ‚Äî <code>items</code> je reserved v Pythonu/Jinja2)."
        }
      ]
    },
    {
      "id": "ai-workflow",
      "title": "AI Workflow",
      "icon": "ü§ñ",
      "blocks": [
        {
          "type": "text",
          "text": "P≈ôed generov√°n√≠m dokumentace p≈ôeƒçti: <code>docs/AI_WORKFLOW.md</code> ‚Äî postup, trap list, checklist."
        },
        {
          "type": "heading",
          "text": "Kr√°tk√Ω souhrn"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "P≈ôeƒçti <code>{projekt}/CLAUDE.md</code> a <code>{projekt}/project.yaml</code>",
            "P≈ôeƒçti <code>docs/schema/doc_schema.json</code> ‚Äî sch√©ma",
            "Vygeneruj <code>docs/data/{projekt}.json</code> dle sch√©matu",
            "Validuj: <code>python3 build.py --project {projekt} --check</code>",
            "Builduj: <code>python3 build.py --project {projekt} --force</code>",
            "Ovƒõ≈ô v prohl√≠≈æeƒçi: <code>http://localhost:8080/docs/{projekt}</code>",
            "Commitni + pushni"
          ]
        }
      ]
    },
    {
      "id": "konvence",
      "title": "Konvence",
      "icon": "üìù",
      "blocks": [
        {
          "type": "list",
          "entries": [
            "<code>docserver.py</code> ‚Äî single-file, ≈æ√°dn√© z√°vislosti mimo stdlib",
            "<code>build.py</code> ‚Äî Jinja2 + volitelnƒõ jsonschema",
            "HTML/CSS/JS inline v <code>docserver.py</code> jako raw string",
            "<code>marked.js</code> naƒçten z CDN ‚Äî fallback na plain text pokud offline",
            "K√≥d ƒçesky, UTF-8"
          ]
        }
      ]
    },
    {
      "id": "cas-ci-problemy",
      "title": "ƒåast√© probl√©my",
      "icon": "‚ö†Ô∏è",
      "blocks": [
        {
          "type": "card",
          "variant": "danger",
          "title": "‚ùå items m√≠sto entries",
          "text": "NEJƒåASTƒöJ≈†√ç CHYBA. <code>items</code> je reserved Pythonu ‚Äî Jinja2 vr√°t√≠ <code>dict.items()</code> metodu.",
          "code": "// ≈†patnƒõ\n{\"type\": \"list\", \"items\": [...]}\n// Spr√°vnƒõ\n{\"type\": \"list\", \"entries\": [...]}"
        },
        {
          "type": "card",
          "variant": "warning",
          "title": "‚ö†Ô∏è Unicode uvozovky v JSON",
          "text": "Pou≈æ√≠vej pouze standardn√≠ uvozovky <code>\\\"</code> a <code>'</code>. Curly quotes (U+201E/U+201D) zp≈Øsob√≠ parse error.",
          "code": "// ≈†patnƒõ: curly quotes (U+201E/U+201D)\n// Spr√°vnƒõ\n\"text\": \"M√° v 'pamƒõti' data\""
        },
        {
          "type": "card",
          "variant": "info",
          "title": "‚ÑπÔ∏è Neplatn√Ω status",
          "text": "Status pole mus√≠ m√≠t specifick√© hodnoty.",
          "code": "Projekt: active / wip / planned / archived\nModul: stable / beta / wip / deprecated"
        }
      ]
    }
  ]
}
