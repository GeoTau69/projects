{
  "project": "backup-dashboard",
  "display_name": "Fedora Backup Dashboard",
  "version": "1.0.0",
  "updated": "2026-02-19",
  "description": "Kompletn√≠ dokumentace 3-vrstv√©ho z√°lohovac√≠ho syst√©mu pro Fedora 43.",
  "status": "active",
  "port": 8090,
  "tech": ["python", "fastapi", "jinja2", "uvicorn"],
  "back_link": {"href": "/", "label": "üè† Zpƒõt na Dashboard"},
  "access": {
    "local": "http://localhost:8090",
    "lan": "http://192.168.0.101:8090",
    "tailscale": "http://fedora:8090"
  },
  "modules": [
    {
      "id": "helpers",
      "name": "helpers.py",
      "file": "helpers.py",
      "purpose": "Sd√≠len√© utility: CONFIG, Jinja2 templates, logov√°n√≠, spou≈°tƒõn√≠ p≈ô√≠kaz≈Ø.",
      "status": "stable",
      "public_methods": [
        {"name": "log_action",  "params": "message: str", "returns": "None",      "description": "Zap√≠≈°e akci do aplikaƒçn√≠ho logu (logs/dashboard.log)."},
        {"name": "run_cmd",     "params": "cmd: list[str]", "returns": "str",     "description": "Spust√≠ p≈ô√≠kaz, vr√°t√≠ stdout. Vyvol√° v√Ωjimku p≈ôi chybƒõ."},
        {"name": "run_sudo",    "params": "cmd: list[str]", "returns": "str",     "description": "Spust√≠ p≈ô√≠kaz p≈ôes sudo. Pro privilegovan√© operace (snapper, btrfs)."},
        {"name": "get_borg_env","params": "", "returns": "dict",                   "description": "Vr√°t√≠ env dict s BORG_PASSCOMMAND pro autentizaci Borg."}
      ],
      "dependencies": [],
      "notes": "CONFIG dict obsahuje centr√°ln√≠ konfiguraci: cesty k disk≈Øm, borg repo, excludes. templates = Jinja2Templates sd√≠len√° pro v≈°echny routery."
    },
    {
      "id": "snapshots",
      "name": "routes/snapshots.py",
      "file": "routes/snapshots.py",
      "purpose": "Snapper endpointy (create, delete, rollback, diff) a datov√° funkce get_snapper_list().",
      "status": "stable",
      "public_methods": [
        {"name": "get_snapper_list", "params": "", "returns": "list[dict]", "description": "Vr√°t√≠ seznam Snapper snapshot≈Ø. Importov√°na a vol√°na v routes/system.py pro dashboard."}
      ],
      "dependencies": ["helpers.run_sudo"]
    },
    {
      "id": "borg",
      "name": "routes/borg.py",
      "file": "routes/borg.py",
      "purpose": "Borg Backup endpointy (create, delete, restore, files, tree) a datov√© funkce.",
      "status": "stable",
      "public_methods": [
        {"name": "get_borg_archives", "params": "", "returns": "list[dict]", "description": "Vr√°t√≠ seznam Borg archiv≈Ø. Importov√°na v routes/system.py."},
        {"name": "get_borg_info",    "params": "", "returns": "dict",       "description": "Vr√°t√≠ info o Borg repu (size, num_archives, last_modified)."}
      ],
      "dependencies": ["helpers.run_cmd", "helpers.get_borg_env"]
    },
    {
      "id": "git",
      "name": "routes/git.py",
      "file": "routes/git.py",
      "purpose": "Git spr√°va workspace p≈ôes web UI ‚Äî log, diff, commit, rollback.",
      "status": "stable",
      "public_methods": [
        {"name": "get_git_log",    "params": "",          "returns": "list[dict]", "description": "Historie commit≈Ø (hash, zpr√°va, datum, autor)."},
        {"name": "get_git_status", "params": "",          "returns": "dict",       "description": "Aktu√°ln√≠ git status ‚Äî staged a unstaged soubory."},
        {"name": "get_git_diff",   "params": "commit: str", "returns": "str",      "description": "Textov√Ω diff konkr√©tn√≠ho commitu."}
      ],
      "dependencies": ["helpers.run_cmd"],
      "notes": "Web UI dostupn√© na /git. Slou≈æ√≠ pro commitov√°n√≠ zmƒõn v ~/projects/ z prohl√≠≈æeƒçe."
    },
    {
      "id": "system",
      "name": "routes/system.py",
      "file": "routes/system.py",
      "purpose": "Hlavn√≠ dashboard endpointy: health, refresh, sync operace, logy, export, nuclear delete.",
      "status": "stable",
      "public_methods": [
        {"name": "get_backup_disk_status", "params": "", "returns": "dict",       "description": "Stav backup disku: mounted, used_percent, free, total."},
        {"name": "get_root_disk_status",   "params": "", "returns": "dict",       "description": "Stav root disku: used_percent, free, total."},
        {"name": "get_health_status",      "params": "", "returns": "dict",       "description": "Agregovan√Ω health check: snapshots, borg, disky, timery. Vrac√≠ seznam warnings."},
        {"name": "get_systemd_timers",     "params": "", "returns": "list[dict]", "description": "Stav systemd timer≈Ø (borg-backup, snapshot-sync, snapper-timeline, snapper-cleanup)."},
        {"name": "get_sync_snapshots",     "params": "", "returns": "list[dict]", "description": "Seznam snapshot≈Ø na backup disku (/mnt/fedora-backups/system-snapshots/)."},
        {"name": "get_dashboard_log",      "params": "n: int = 100", "returns": "list[str]", "description": "Posledn√≠ch N ≈ô√°dk≈Ø z logs/dashboard.log."}
      ],
      "dependencies": ["helpers", "routes.snapshots.get_snapper_list", "routes.borg.get_borg_archives"]
    }
  ],
  "sections": [
    {
      "id": "live-status",
      "title": "Live Status",
      "icon": "üìä",
      "blocks": [
        {"type": "live_status", "api_endpoint": "/api/health"}
      ]
    },
    {
      "id": "architektura",
      "title": "Architektura",
      "icon": "üóÉÔ∏è",
      "blocks": [
        {"type": "text", "text": "3-vrstv√° z√°lohovac√≠ architektura: Snapper snapshoty (vrstva 1), Btrfs sync na z√°lo≈æn√≠ disk (vrstva 2) a Borg backup ≈°ifrovan√Ωch dat (vrstva 3). V≈°e ovl√°d√°no p≈ôes Dashboard na portu 8090."},
        {"type": "table",
          "headers": ["Komponenta", "Technologie", "Co z√°lohuje", "Kam"],
          "rows": [
            ["<span class=\"badge badge-green\">Vrstva 1</span> Snapper", "Btrfs snapshoty", "Cel√Ω root filesystem <code>/</code>", "<code>/.snapshots/</code> (lok√°ln√≠)"],
            ["<span class=\"badge badge-yellow\">Vrstva 2</span> Btrfs Sync", "btrfs send/receive", "Kopie snapshot≈Ø z /.snapshots/", "<code>/mnt/fedora-backups/system-snapshots/</code>"],
            ["<span class=\"badge badge-purple\">Vrstva 3</span> Borg", "Borg Backup (≈°ifrovan√Ω, dedup)", "<code>/home/geo/</code>", "<code>/mnt/fedora-backups/borg-repo/</code>"]
          ]
        }
      ]
    },
    {
      "id": "vrstvy",
      "title": "3 vrstvy z√°loh",
      "icon": "üìö",
      "blocks": [
        {"type": "heading", "text": "Vrstva 1: Snapper (Btrfs snapshoty)"},
        {"type": "card", "variant": "info", "title": "üì∏ Lok√°ln√≠ snapshoty cel√©ho syst√©mu",
          "entries": [
            "<strong>Co:</strong> Atomick√Ω snapshot Btrfs subvolumu <code>/</code>",
            "<strong>Kdy automaticky:</strong> Ka≈ædou hodinu (timeline), p≈ôed/po DNF operac√≠ch",
            "<strong>Retence:</strong> 5 hodinov√Ωch, 7 denn√≠ch, 4 t√Ωdenn√≠ch, 6 mƒõs√≠ƒçn√≠ch, 2 roƒçn√≠ch",
            "<strong>Rychlost:</strong> Okam≈æit√Ω (&lt; 1 sekunda)",
            "<strong>Rollback:</strong> <code>snapper rollback ƒå√çSLO</code> + reboot",
            "<strong>GOLDEN snapshot:</strong> Referenƒçn√≠ ƒçist√Ω stav syst√©mu, chr√°nƒõn√Ω p≈ôed smaz√°n√≠m"
          ]
        },
        {"type": "heading", "text": "Vrstva 2: Btrfs Send/Receive"},
        {"type": "card", "variant": "info", "title": "üîÑ Sync snapshot≈Ø na z√°lo≈æn√≠ disk",
          "entries": [
            "<strong>Co:</strong> Kopie snapshot≈Ø z <code>/.snapshots/</code> na <code>/mnt/fedora-backups/</code>",
            "<strong>Kdy:</strong> Dennƒõ ve 03:32 (systemd timer)",
            "<strong>√öƒçel:</strong> Z√°chrana p≈ôi selh√°n√≠ syst√©mov√©ho disku",
            "<strong>Typ:</strong> Inkrement√°ln√≠ (pouze zmƒõny)"
          ]
        },
        {"type": "heading", "text": "Vrstva 3: Borg Backup"},
        {"type": "card", "variant": "info", "title": "üîê ≈†ifrovan√© z√°lohy /home",
          "entries": [
            "<strong>Co:</strong> Cel√Ω <code>/home/geo/</code> (s excludes: cache, thinclient_drives)",
            "<strong>Kdy:</strong> Dennƒõ ve 03:13 (systemd timer)",
            "<strong>≈†ifrov√°n√≠:</strong> Ano (passphrase v <code>~/.borg-passphrase</code>)",
            "<strong>Deduplikace:</strong> Ano (identick√© bloky ulo≈æeny jen jednou)",
            "<strong>Komprese:</strong> zstd",
            "<strong>Browse:</strong> Proch√°zen√≠ soubor≈Ø v archivu a obnoven√≠ jednotliv√Ωch soubor≈Ø"
          ]
        }
      ]
    },
    {
      "id": "soubory",
      "title": "Soubory a cesty",
      "icon": "üìÅ",
      "blocks": [
        {"type": "table",
          "headers": ["Cesta", "Popis"],
          "rows": [
            ["<code>~/projects/backup-dashboard/app.py</code>", "Hlavn√≠ aplikace dashboardu"],
            ["<code>~/projects/backup-dashboard/templates/</code>", "HTML ≈°ablony (Jinja2)"],
            ["<code>~/projects/backup-dashboard/logs/dashboard.log</code>", "Aplikaƒçn√≠ log"],
            ["<code>/etc/systemd/system/backup-dashboard.service</code>", "Systemd service (system)"],
            ["<code>/.snapshots/</code>", "Snapper snapshoty (lok√°ln√≠, na root disku)"],
            ["<code>/mnt/fedora-backups/borg-repo/</code>", "Borg repository (≈°ifrovan√°)"],
            ["<code>/mnt/fedora-backups/system-snapshots/</code>", "Sync snapshoty z Vrstva 2"],
            ["<code>~/.borg-passphrase</code>", "Borg heslo (chra≈à jako kl√≠ƒç!)"],
            ["<code>~/borg-key-backup.txt</code>", "Exportovan√Ω Borg kl√≠ƒç (z√°loha)"]
          ]
        }
      ]
    },
    {
      "id": "dashboard",
      "title": "Dashboard",
      "icon": "üñ•Ô∏è",
      "blocks": [
        {"type": "text", "text": "Dashboard je dostupn√Ω na:"},
        {"type": "list", "entries": [
          "Lok√°lnƒõ: <code>http://localhost:8090/</code>",
          "Ze s√≠tƒõ: <code>http://192.168.0.101:8090/</code>",
          "P≈ôes Tailscale: <code>http://fedora:8090/</code>"
        ]},
        {"type": "heading", "text": "Sekce dashboardu"},
        {"type": "table",
          "headers": ["Sekce", "Funkce"],
          "rows": [
            ["üíæ Disky", "Stav root a backup disku, vyu≈æit√≠ m√≠sta"],
            ["‚è∞ Automatick√© √∫lohy", "Stav systemd timer≈Ø, p≈ô√≠≈°t√≠/posledn√≠ spu≈°tƒõn√≠"],
            ["üì∏ Snapper Snapshoty", "Seznam, vytvo≈ôen√≠, smaz√°n√≠, diff, rollback"],
            ["üîê Borg Archivy", "Seznam, vytvo≈ôen√≠, browse soubor≈Ø, restore, smaz√°n√≠"],
            ["üîÑ Btrfs Sync", "Ruƒçn√≠ sync snapshot≈Ø na backup disk"],
            ["üöÄ Full Flow", "Kompletn√≠ z√°loha v jednom kroku (snapshot + borg + sync)"],
            ["‚ò¢Ô∏è Nuclear Delete", "Smaz√°n√≠ v≈°ech z√°loh (chr√°nƒõno heslem + 2√ó potvrzen√≠m)"],
            ["üìã Log", "Historie akc√≠ dashboardu, export, smaz√°n√≠"]
          ]
        }
      ]
    },
    {
      "id": "rucni-snapshot",
      "title": "Ruƒçn√≠ snapshot",
      "icon": "üì∏",
      "blocks": [
        {"type": "list", "ordered": true, "entries": [
          "Otev≈ôi dashboard",
          "V sekci <strong>Snapper Snapshoty</strong> zadej popis (nap≈ô. \"P≈ôed instalac√≠ NVIDIA\")",
          "Klikni <strong>+ Snapshot</strong>",
          "Snapshot se vytvo≈ô√≠ okam≈æitƒõ (&lt; 1 s)"
        ]},
        {"type": "card", "variant": "success", "title": "üí° Tip",
          "text": "V≈ædy dƒõlej snapshot P≈òED rizikov√Ωmi operacemi: aktualizace kernelu, instalace ovladaƒç≈Ø, zmƒõny konfigurace."
        }
      ]
    },
    {
      "id": "rucni-borg",
      "title": "Ruƒçn√≠ Borg backup",
      "icon": "üîê",
      "blocks": [
        {"type": "list", "ordered": true, "entries": [
          "V sekci <strong>Borg Archivy</strong> zadej koment√°≈ô",
          "Klikni <strong>+ Backup</strong>",
          "Backup trv√° podle velikosti dat (typicky 1‚Äì5 minut)",
          "N√°zev archivu: <code>[koment√°≈ô-slug]-[YYYYMMDD-HHMMSS]</code>"
        ]}
      ]
    },
    {
      "id": "full-flow",
      "title": "Full Flow (3-v-1)",
      "icon": "üöÄ",
      "blocks": [
        {"type": "text", "text": "Provede kompletn√≠ z√°lohu ve 3 kroc√≠ch:"},
        {"type": "list", "ordered": true, "entries": [
          "<span class=\"badge badge-blue\">Krok 1</span> Vytvo≈ô√≠ Snapper snapshot (popis s prefixem [FULL])",
          "<span class=\"badge badge-purple\">Krok 2</span> Spust√≠ Borg backup cel√©ho /home",
          "<span class=\"badge badge-yellow\">Krok 3</span> Sync snapshot≈Ø na backup disk"
        ]},
        {"type": "card", "variant": "warning", "title": "‚è±Ô∏è ƒåas",
          "text": "Full Flow trv√° typicky 2‚Äì10 minut. Str√°nka se po dokonƒçen√≠ automaticky refreshne."
        }
      ]
    },
    {
      "id": "restore",
      "title": "Obnoven√≠ dat",
      "icon": "‚ôªÔ∏è",
      "blocks": [
        {"type": "heading", "text": "Ze Snapper snapshotu (syst√©mov√© soubory)"},
        {"type": "code", "lang": "bash", "text": "# Najdi snapshot\nsudo snapper -c root list\n\n# Proch√°zej soubory\nls /.snapshots/ƒå√çSLO/snapshot/cesta/k/souboru\n\n# Kop√≠ruj zpƒõt\nsudo cp /.snapshots/ƒå√çSLO/snapshot/etc/config.conf /etc/config.conf"},
        {"type": "heading", "text": "Z Borg archivu (home soubory) ‚Äî p≈ôes Dashboard"},
        {"type": "list", "ordered": true, "entries": [
          "Klikni ‚ôªÔ∏è u archivu v sekci Borg Archivy",
          "Proch√°zej adres√°≈ôovou strukturu (klik na üìÅ slo≈æky)",
          "Vyber soubor/slo≈æku kliknut√≠m na ‚òëÔ∏è",
          "Zvol re≈æim: <strong>Do c√≠lov√© slo≈æky</strong> (bezpeƒçn√©) nebo <strong>Na p≈Øvodn√≠ m√≠sto</strong> (p≈ôep√≠≈°e)",
          "Klikni <strong>Obnovit</strong>"
        ]},
        {"type": "heading", "text": "Z Borg archivu ‚Äî p≈ôes CLI"},
        {"type": "code", "lang": "bash", "text": "export BORG_PASSCOMMAND=\"cat ~/.borg-passphrase\"\n\n# Seznam archiv≈Ø\nborg list /mnt/fedora-backups/borg-repo\n\n# Obnovit jeden soubor\ncd /tmp\nborg extract /mnt/fedora-backups/borg-repo::ARCHIV home/geo/cesta/soubor\n\n# Obnovit v≈°e\ncd /\nborg extract /mnt/fedora-backups/borg-repo::ARCHIV"}
      ]
    },
    {
      "id": "rollback",
      "title": "Rollback syst√©mu",
      "icon": "‚è™",
      "blocks": [
        {"type": "card", "variant": "danger", "title": "‚ö†Ô∏è Rollback vr√°t√≠ CEL√ù syst√©m do stavu snapshotu",
          "text": "V≈°echny zmƒõny po snapshotu budou ztraceny. /home z≈Østane nedotƒçen (je na zvl√°≈°tn√≠m subvolumu jen pokud je separ√°tn√≠)."
        },
        {"type": "heading", "text": "Z dashboardu"},
        {"type": "list", "ordered": true, "entries": [
          "Klikni ‚è™ u snapshotu",
          "Potvrƒè 2√ó bezpeƒçnostn√≠ dialog",
          "<strong>RESTARTUJ syst√©m</strong> ‚Äî rollback se dokonƒç√≠ a≈æ po rebootu"
        ]},
        {"type": "heading", "text": "Z CLI"},
        {"type": "code", "lang": "bash", "text": "sudo snapper -c root rollback ƒå√çSLO\nsudo reboot"},
        {"type": "heading", "text": "Z GRUBu (syst√©m nebootuje)"},
        {"type": "list", "ordered": true, "entries": [
          "P≈ôi startu vyber <strong>Fedora Snapshots</strong> v GRUB menu",
          "Vyber po≈æadovan√Ω snapshot",
          "Po nabootov√°n√≠ spus≈•: <code>sudo snapper -c root rollback ƒå√çSLO &amp;&amp; sudo reboot</code>"
        ]}
      ]
    },
    {
      "id": "nuclear",
      "title": "Nuclear Delete",
      "icon": "‚ò¢Ô∏è",
      "blocks": [
        {"type": "card", "variant": "danger", "title": "NEVRATN√â smaz√°n√≠ v≈°ech z√°loh",
          "text": "Chr√°nƒõno: heslem + potvrzovac√≠m textem <code>SMAZAT VSE</code> + 2√ó confirm dialog. Sma≈æe:",
          "entries": [
            "V≈°echny Snapper snapshoty (kromƒõ #0 current a GOLDEN)",
            "V≈°echny Borg archivy",
            "V≈°echny sync snapshoty z backup disku"
          ]
        }
      ]
    },
    {
      "id": "cli-snapper",
      "title": "CLI: Snapper",
      "icon": "‚å®Ô∏è",
      "blocks": [
        {"type": "code", "lang": "bash", "text": "# Seznam snapshot≈Ø\nsudo snapper -c root list\n\n# Vytvo≈ôit snapshot\nsudo snapper -c root create --description \"Popis\" --print-number\n\n# Diff mezi snapshoty\nsudo snapper -c root status ƒå√çSLO1..ƒå√çSLO2\n\n# Rollback\nsudo snapper -c root rollback ƒå√çSLO\nsudo reboot\n\n# Smazat snapshot\nsudo snapper -c root delete ƒå√çSLO\n\n# Konfigurace\nsudo snapper -c root get-config"}
      ]
    },
    {
      "id": "cli-borg",
      "title": "CLI: Borg",
      "icon": "‚å®Ô∏è",
      "blocks": [
        {"type": "code", "lang": "bash", "text": "export BORG_PASSCOMMAND=\"cat ~/.borg-passphrase\"\n\n# Seznam archiv≈Ø\nborg list /mnt/fedora-backups/borg-repo\n\n# Info o repu\nborg info /mnt/fedora-backups/borg-repo\n\n# Vytvo≈ôit backup\nborg create --compression zstd --one-file-system \\\n  /mnt/fedora-backups/borg-repo::nazev-DATUM \\\n  /home/geo \\\n  --exclude '*.cache*' --exclude 'thinclient_drives'\n\n# Proch√°zet archiv\nborg list /mnt/fedora-backups/borg-repo::ARCHIV\n\n# Obnovit do /tmp\ncd /tmp && borg extract /mnt/fedora-backups/borg-repo::ARCHIV\n\n# Mountnout jako FS\nborg mount /mnt/fedora-backups/borg-repo::ARCHIV /mnt/borg-mount\n\n# Kontrola integrity\nborg check /mnt/fedora-backups/borg-repo\n\n# Compact (uvolnit m√≠sto po smaz√°n√≠ archiv≈Ø)\nborg compact /mnt/fedora-backups/borg-repo"}
      ]
    },
    {
      "id": "cli-sync",
      "title": "CLI: Btrfs Sync",
      "icon": "‚å®Ô∏è",
      "blocks": [
        {"type": "code", "lang": "bash", "text": "# Ruƒçn√≠ spu≈°tƒõn√≠\nsudo systemctl start snapshot-sync.service\n\n# Log\nsudo cat /var/log/backup-snapshot-sync.log\n\n# Stav timeru\nsystemctl status snapshot-sync.timer"}
      ]
    },
    {
      "id": "smazany-soubor",
      "title": "Sc√©n√°≈ô: Smazan√Ω soubor",
      "icon": "üî•",
      "blocks": [
        {"type": "heading", "text": "Syst√©mov√Ω soubor (konfigurace, bin√°rka)"},
        {"type": "card", "title": "Ze Snapper snapshotu",
          "code": "sudo ls /.snapshots/ƒå√çSLO/snapshot/cesta/\nsudo cp /.snapshots/ƒå√çSLO/snapshot/etc/soubor /etc/soubor"
        },
        {"type": "heading", "text": "Home soubor"},
        {"type": "card", "title": "Z Borg archivu",
          "code": "export BORG_PASSCOMMAND=\"cat ~/.borg-passphrase\"\ncd /tmp\nborg extract /mnt/fedora-backups/borg-repo::ARCHIV home/geo/soubor"
        },
        {"type": "text", "text": "Nebo p≈ôes Dashboard ‚Üí Borg ‚Üí ‚ôªÔ∏è Restore"}
      ]
    },
    {
      "id": "rozbity-update",
      "title": "Sc√©n√°≈ô: Rozbit√Ω update",
      "icon": "üî•",
      "blocks": [
        {"type": "heading", "text": "Syst√©m bootuje"},
        {"type": "card", "title": "Syst√©m bootuje ‚Äî rollback p≈ôes CLI",
          "code": "sudo snapper -c root list          # naj√≠t pre-dnf snapshot\nsudo snapper -c root rollback ƒå√çSLO\nsudo reboot"
        },
        {"type": "heading", "text": "Syst√©m NEBOOTUJE"},
        {"type": "card", "title": "Syst√©m nebootuje ‚Äî GRUB recovery",
          "entries": [
            "GRUB ‚Üí <strong>Fedora Snapshots</strong> ‚Üí vyber snapshot ‚Üí boot",
            "Po nabootov√°n√≠: <code>sudo snapper -c root rollback ƒå√çSLO &amp;&amp; sudo reboot</code>"
          ]
        }
      ]
    },
    {
      "id": "mrtvy-disk",
      "title": "Sc√©n√°≈ô: Mrtv√Ω syst√©mov√Ω disk",
      "icon": "üî•",
      "blocks": [
        {"type": "card", "variant": "danger", "title": "Kompletn√≠ obnova z backup disku",
          "code": "# 1. Boot z Live USB\n# 2. P≈ôiprav nov√Ω disk\nmkfs.btrfs -L fedora /dev/NEW_DISK\nmount /dev/NEW_DISK /mnt/new\nmount /dev/nvme0n1p1 /mnt/backup\n\n# 3. Obnov syst√©m ze snapshotu\nls /mnt/backup/system-snapshots/\nbtrfs send /mnt/backup/system-snapshots/SNAPSHOT | btrfs receive /mnt/new/\nmv /mnt/new/SNAPSHOT /mnt/new/root\nbtrfs subvolume set-default /mnt/new/root\n\n# 4. Reinstall GRUB + oprav fstab\n# 5. Reboot\n\n# 6. Obnov /home\nexport BORG_PASSCOMMAND=\"cat /cesta/k/passphrase\"\ncd / && borg extract /mnt/backup/borg-repo::ARCHIV"
        }
      ]
    },
    {
      "id": "ransomware",
      "title": "Sc√©n√°≈ô: Ransomware",
      "icon": "üî•",
      "blocks": [
        {"type": "card", "title": "Postup obnovy po ransomware √∫toku",
          "code": "# 1. ODPOJ poƒç√≠taƒç od s√≠tƒõ OKAM≈ΩITƒö\n# 2. Boot z Live USB\n\n# 3. Obnov syst√©m ze snapshotu P≈òED √∫tokem\nsudo snapper -c root rollback ƒå√çSLO\n\n# 4. Obnov home z Borg archivu P≈òED √∫tokem\nexport BORG_PASSCOMMAND=\"cat ~/.borg-passphrase\"\nborg list /mnt/fedora-backups/borg-repo    # najdi archiv P≈òED datem √∫toku\ncd / && borg extract /mnt/fedora-backups/borg-repo::ARCHIV"
        }
      ]
    },
    {
      "id": "factory-reset",
      "title": "Sc√©n√°≈ô: Factory reset",
      "icon": "üî•",
      "blocks": [
        {"type": "card", "variant": "success", "title": "N√°vrat na GOLDEN snapshot",
          "code": "sudo snapper -c root list     # najdi GOLDEN snapshot\nsudo snapper -c root rollback ƒå√çSLO_GOLDEN\nsudo reboot"
        },
        {"type": "text", "text": "Nebo p≈ôes Dashboard ‚Üí klikni ‚è™ u GOLDEN snapshotu"}
      ]
    },
    {
      "id": "automaticke",
      "title": "Automatick√© √∫lohy",
      "icon": "‚è∞",
      "blocks": [
        {"type": "table",
          "headers": ["Timer", "Kdy", "Co dƒõl√°"],
          "rows": [
            ["<code>snapper-timeline.timer</code>", "Ka≈ædou hodinu", "Vytvo≈ô√≠ timeline snapshot"],
            ["<code>snapper-cleanup.timer</code>", "Ka≈ædou hodinu", "Sma≈æe star√© snapshoty dle retence"],
            ["<code>borg-backup.timer</code>", "Dennƒõ ~03:13", "Borg backup /home/geo"],
            ["<code>snapshot-sync.timer</code>", "Dennƒõ ~03:32", "Btrfs send/receive na backup disk"]
          ]
        },
        {"type": "code", "lang": "bash", "text": "# Ovƒõ≈ôen√≠ stavu timer≈Ø\nsystemctl list-timers | grep -iE 'borg|snapshot|snapper'"}
      ]
    },
    {
      "id": "monitoring",
      "title": "Monitoring",
      "icon": "üìä",
      "blocks": [
        {"type": "code", "lang": "bash", "text": "# Zdrav√≠ syst√©mu (JSON)\ncurl -s http://localhost:8090/api/health | python3 -m json.tool\n\n# M√≠sto na disc√≠ch\ndf -h / /mnt/fedora-backups\n\n# Je backup disk mounted?\nmountpoint /mnt/fedora-backups\n\n# Posledn√≠ borg backup\nexport BORG_PASSCOMMAND=\"cat ~/.borg-passphrase\"\nborg list /mnt/fedora-backups/borg-repo --last 1\n\n# Dashboard log\ntail -20 ~/projects/backup-dashboard/logs/dashboard.log\n\n# Systemd logy\nsudo journalctl -u borg-backup.service --since today\nsudo journalctl -u snapshot-sync.service --since today\nsudo journalctl -u backup-dashboard.service -n 20"}
      ]
    },
    {
      "id": "rizika",
      "title": "Rizika a limity",
      "icon": "‚ö†Ô∏è",
      "blocks": [
        {"type": "card", "variant": "danger", "title": "üîë Borg kl√≠ƒç a heslo",
          "text": "Bez <code>~/.borg-passphrase</code> a <code>~/borg-key-backup.txt</code> jsou Borg z√°lohy <strong>NEƒåITELN√â</strong>. Ulo≈æ kopie mimo tento poƒç√≠taƒç: USB disk, cloud, tisk na pap√≠r."
        },
        {"type": "card", "variant": "warning", "title": "üåê ≈Ω√°dn√Ω offsite backup",
          "text": "Obƒõ z√°lohy (Snapper i Borg) jsou fyzicky na stejn√©m m√≠stƒõ. Kr√°de≈æ, po≈æ√°r nebo p≈ôepƒõt√≠ = ztr√°ta v≈°eho. Zva≈æ: BorgBase, rsync.net, druh√Ω PC, NAS."
        },
        {"type": "card", "variant": "warning", "title": "üíæ Backup disk mus√≠ b√Ωt mounted",
          "text": "Pokud <code>/mnt/fedora-backups</code> nen√≠ p≈ôipojen, Borg i Sync z√°lohy <strong>sel≈æou ti≈°e</strong>. Dashboard zobrazuje varov√°n√≠, ale automatick√© √∫lohy mohou selhat bez notifikace."
        },
        {"type": "card", "variant": "info", "title": "üìè Limity",
          "entries": [
            "Snapper snapshoty zab√≠raj√≠ m√≠sto na root disku √∫mƒõrnƒõ zmƒõn√°m ‚Äî sleduj <code>df -h /</code>",
            "Borg deduplikace ≈°et≈ô√≠ m√≠sto, ale repo roste s ƒçasem ‚Äî pravidelnƒõ spou≈°tƒõj <code>borg compact</code>",
            "Dashboard bƒõ≈æ√≠ jako root (nutn√© pro snapper/btrfs operace)",
            "Restore z dashboardu zat√≠m v development f√°zi"
          ]
        }
      ]
    }
  ]
}
