{
  "project": "ai",
  "display_name": "AI Dev Agent Stack",
  "version": "1.1.0",
  "updated": "2026-02-21",
  "description": "Komplexn√≠ sada n√°stroj≈Ø pro optimalizaci a spr√°vu pr√°ce s AI. Zahrnuje √∫ƒçetnictv√≠ token≈Ø, prompt cache, s√©mantick√© vyhled√°v√°n√≠ k√≥du, model routing, dokumentaƒçn√≠ pipeline a persistentn√≠ session syst√©m.",
  "status": "active",
  "port": null,
  "tech": [
    "python",
    "sqlite",
    "numpy",
    "ollama",
    "anthropic-api",
    "markdown"
  ],
  "access": {
    "local": "http://localhost:8080?project=ai",
    "lan": "http://192.168.0.101:8080?project=ai"
  },
  "modules": [
    {
      "id": "token_tracker",
      "name": "Token Tracker",
      "file": "_meta/token_tracker.py",
      "purpose": "SQLite √∫ƒçetnictv√≠ API vol√°n√≠, deduplicn√≠ prompt cache a automatick√© model routing.",
      "status": "stable",
      "public_methods": [
        {
          "name": "call_api",
          "params": "project: str, operation: str, model: str = 'auto', messages: list, system: str = ''",
          "returns": "str",
          "description": "Jednotn√© rozhran√≠ pro API vol√°n√≠ s automatick√Ωm routingem, cache lookup, logov√°n√≠m a deduplic√≠."
        },
        {
          "name": "agent log",
          "params": "--project X --operation op --model sonnet --in 5000 --out 1200",
          "returns": "None",
          "description": "Ruƒçn√≠ z√°znam API vol√°n√≠ pro Claude Code sessions."
        },
        {
          "name": "agent billing",
          "params": "--today|--week|--month|--top|--project X|--model M",
          "returns": "str (tabulka)",
          "description": "P≈ôehled n√°klad≈Ø na API vol√°n√≠. Podpora filtrov√°n√≠ a agregace."
        },
        {
          "name": "agent cache",
          "params": "--stats|--list|--clear|--clear --all",
          "returns": "str (v√Ωpis)",
          "description": "Spr√°va prompt cache: statistiky, seznam, vymaz√°n√≠."
        },
        {
          "name": "agent route",
          "params": "--show|--test OPERACE",
          "returns": "str (tabulka)",
          "description": "Zobrazen√≠ a testov√°n√≠ model routing tabulky."
        }
      ],
      "dependencies": [],
      "notes": "Datab√°ze: ~/.ai-agent/tokens.db. Dostupn√© p≈ôes CLI ~/bin/agent. Model routing rozhoduje mezi Ollama (local) a Claude (cloud)."
    },
    {
      "id": "chroma_indexer",
      "name": "S√©mantick√Ω vyhled√°vaƒç",
      "file": "_meta/chroma_indexer.py",
      "purpose": "Indexov√°n√≠ a vyhled√°v√°n√≠ k√≥du pomoc√≠ vektorov√Ωch embedding≈Ø (nomic-embed-text p≈ôes Ollama).",
      "status": "stable",
      "public_methods": [
        {
          "name": "agent index",
          "params": "[--project NAME|--diff|--force|--docs]",
          "returns": "None",
          "description": "Indexov√°n√≠ workspace ƒçi jednoho projektu. Strategie: per-definition pro Python, per-sekci pro Markdown."
        },
        {
          "name": "agent search",
          "params": "\"dotaz\" [--project X|--top N|--scope docs]",
          "returns": "list[SearchResult]",
          "description": "S√©mantick√© vyhled√°v√°n√≠ k√≥du a dokumentace. Vrac√≠ relevance sk√≥re (0‚Äì1)."
        }
      ],
      "dependencies": [
        "token_tracker (pro Ollama API)"
      ],
      "notes": "Datab√°ze: ~/.ai-agent/code_index.db (SQLite BLOB + numpy cosine similarity). Kompatibiln√≠ s Python 3.14 (alternativa k chromadb). Chunking: 60 ≈ô√°dk≈Ø s overlap=10 pro ostatn√≠ typy soubor≈Ø."
    },
    {
      "id": "docs_pipeline",
      "name": "Docs Pipeline",
      "file": "docs/build.py",
      "purpose": "JSON ‚Üí HTML renderer (Jinja2). AI generuje JSON, build.py renderuje statick√© HTML bez √∫ƒçasti AI.",
      "status": "stable",
      "public_methods": [
        {
          "name": "build.py",
          "params": "[--project NAME|--check|--force|--output FILE]",
          "returns": "HTML file",
          "description": "Transformace docs/data/{projekt}.json ‚Üí docs/output/{projekt}.html. Hash cache pro inkrement√°ln√≠ buildy."
        }
      ],
      "dependencies": [
        "jinja2"
      ],
      "notes": "Kl√≠ƒçov√© pravidlo: seznam polo≈æek se zapisuje jako 'entries' (ne 'items' ‚Äî Jinja2 conflict). Sch√©ma: docs/schema/doc_schema.json."
    },
    {
      "id": "persistence_system",
      "name": "Persistence pamƒõti",
      "file": "memory/MEMORY.md + memory/session.md",
      "purpose": "Cross-model persistentn√≠ session syst√©m. Zachov√°v√° kontext nap≈ô√≠ch seseionami a model≈Ø (Haiku ‚Üî Sonnet ‚Üî Opus).",
      "status": "stable",
      "public_methods": [
        {
          "name": "konec zvonec",
          "params": "N/A ‚Äî sign√°ln√≠ fr√°ze",
          "returns": "Tich√© ulo≈æen√≠ stavu",
          "description": "Trigger pro ulo≈æen√≠ MEMORY.md + MODEL.md SESSION LOG + git commit+push. Plat√≠ pro v≈°echny modely."
        }
      ],
      "dependencies": [],
      "notes": "Auto-memory adres√°≈ô: ~/.claude/projects/{hash}/memory/. MEMORY.md je auto-naƒç√≠t√°n Claudem p≈ôi ka≈æd√© nov√© konverzaci. Max 200 ≈ô√°dk≈Ø. SESSION LOG v MODEL.md je handoff dokument (versioned v git)."
    }
  ],
  "sections": [
    {
      "id": "prehled",
      "title": "P≈ôehled",
      "icon": "üìã",
      "blocks": [
        {
          "type": "text",
          "text": "AI Dev Agent Stack je integrovan√Ω syst√©m ƒçty≈ô komponent: <code>token_tracker</code> pro √∫ƒçetnictv√≠, <code>chroma_indexer</code> pro s√©mantick√© vyhled√°v√°n√≠, <code>docs pipeline</code> pro generov√°n√≠ dokumentace a <code>persistence syst√©m</code> pro uchov√°n√≠ kontextu nap≈ô√≠ch seseionami."
        },
        {
          "type": "heading",
          "text": "Kl√≠ƒçov√© funkce"
        },
        {
          "type": "list",
          "entries": [
            "Transparentn√≠ √∫ƒçetnictv√≠ token≈Ø s TTL cache pro Anthropic API",
            "S√©mantick√© vyhled√°v√°n√≠ k√≥du (SQLite + numpy, bez chromadb)",
            "Automatick√Ω routing mezi Ollama (local, zdarma) a Claude API (cloud, placen√©)",
            "AI generuje pouze JSON data, Python renderuje HTML p≈ôes Jinja2",
            "Cross-model persistence: jeden model pokraƒçuje kde skonƒçil druh√Ω"
          ]
        },
        {
          "type": "heading",
          "text": "Status implementace (2026-02-21)"
        },
        {
          "type": "table",
          "headers": ["Modul", "Status", "Soubor"],
          "rows": [
            ["Token √∫ƒçetnictv√≠", "‚úÖ HOTOVO", "_meta/token_tracker.py"],
            ["Prompt cache / deduplication", "‚úÖ HOTOVO", "_meta/token_tracker.py"],
            ["S√©mantick√Ω vyhled√°vaƒç k√≥du", "‚úÖ HOTOVO", "_meta/chroma_indexer.py"],
            ["Model routing", "‚úÖ HOTOVO", "_meta/token_tracker.py"],
            ["Docs pipeline (JSON/Jinja2)", "‚úÖ HOTOVO", "docs/build.py"],
            ["Persistence pamƒõti", "‚úÖ HOTOVO", "memory/MEMORY.md + CLAUDE.md Golden Rule"]
          ]
        }
      ]
    },
    {
      "id": "architektura",
      "title": "Architektura",
      "icon": "üèóÔ∏è",
      "blocks": [
        {
          "type": "heading",
          "text": "Komponenty"
        },
        {
          "type": "code",
          "lang": "text",
          "text": "~/bin/agent  (router)\n    ‚îú‚îÄ‚îÄ log / billing / cache / route / init  ‚Üí  _meta/token_tracker.py\n    ‚îî‚îÄ‚îÄ index / search                         ‚Üí  _meta/chroma_indexer.py\n\nDatab√°ze: ~/.ai-agent/\n    ‚îú‚îÄ‚îÄ tokens.db       ‚Äî token log + prompt cache (SQLite)\n    ‚îî‚îÄ‚îÄ code_index.db   ‚Äî k√≥dov√© chunky + numpy embeddingy (SQLite)\n\nOllama (lok√°ln√≠):\n    ‚îú‚îÄ‚îÄ nomic-embed-text  ‚Äî embeddingy pro s√©mantick√© vyhled√°v√°n√≠\n    ‚îî‚îÄ‚îÄ qwen2.5-coder:14b ‚Äî lok√°ln√≠ LLM pro doc_update, boilerplate, info_sync\n\nPersistence: ~/.claude/projects/{hash}/memory/\n    ‚îú‚îÄ‚îÄ MEMORY.md       ‚Äî auto-loaded p≈ôi ka≈ºd√© session (volatile state)\n    ‚îî‚îÄ‚îÄ session.md      ‚Äî detailn√≠ session log"
        }
      ]
    },
    {
      "id": "token_tracker",
      "title": "Token Tracker",
      "icon": "üí∞",
      "blocks": [
        {
          "type": "text",
          "text": "SQLite √∫ƒçetnictv√≠ v≈°ech API vol√°n√≠ + prompt cache + model routing. Centr√°ln√≠ bod pro kontrolu n√°klad≈Ø na AI pr√°ci."
        },
        {
          "type": "heading",
          "text": "CLI p≈ô√≠kazy"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "# Manu√°ln√≠ z√°znam (pro Claude Code sessions)\nagent log --project X --operation doc_update --model sonnet --in 5000 --out 1200 [--notes \"...\"]\n\n# P≈ôehledy\nagent billing                    # v≈°e\nagent billing --today            # jen dnes\nagent billing --week             # posledn√≠ch 7 dn√≠\nagent billing --month            # posledn√≠ch 30 dn√≠\nagent billing --project X        # filtr projektu\nagent billing --model sonnet     # filtr modelu\nagent billing --top              # top operace dle ceny\n\n# Prompt cache\nagent cache --stats              # statistiky + TTL pravidla\nagent cache --list               # seznam ulo≈æen√Ωch odpovƒõd√≠\nagent cache --clear              # smazat expirovan√©\nagent cache --clear --all        # smazat v≈°e\n\n# Model routing\nagent route --show               # zobrazit routing tabulku\nagent route --test doc_update    # otestovat routing pro operaci\n\n# Init\nagent init                       # inicializovat ~/.ai-agent/ a DB"
        },
        {
          "type": "heading",
          "text": "Model routing tabulka"
        },
        {
          "type": "table",
          "headers": ["Operace", "C√≠l", "Model"],
          "rows": [
            ["doc_update", "local", "qwen2.5-coder:14b"],
            ["boilerplate", "local", "qwen2.5-coder:14b"],
            ["info_sync", "local", "qwen2.5-coder:14b"],
            ["code_review", "cloud", "claude-sonnet-4-6"],
            ["architecture", "cloud", "claude-opus-4-6"],
            ["debug_complex", "cloud", "claude-sonnet-4-6"],
            ["_default", "cloud", "claude-sonnet-4-6"]
          ]
        },
        {
          "type": "heading",
          "text": "Ceny model≈Ø"
        },
        {
          "type": "table",
          "headers": ["Model", "Input", "Output"],
          "rows": [
            ["claude-opus-4-6", "$15/M", "$75/M"],
            ["claude-sonnet-4-6", "$3/M", "$15/M"],
            ["claude-haiku-4-5", "$0.80/M", "$4/M"],
            ["Ollama (lok√°ln√≠)", "$0", "$0"]
          ]
        }
      ]
    },
    {
      "id": "semantic_search",
      "title": "S√©mantick√© vyhled√°v√°n√≠",
      "icon": "üîç",
      "blocks": [
        {
          "type": "text",
          "text": "Indexov√°n√≠ a vyhled√°v√°n√≠ k√≥du pomoc√≠ vektorov√Ωch embedding≈Ø. Stack: SQLite + numpy + nomic-embed-text p≈ôes Ollama HTTP. Kompatibiln√≠ s Python 3.14 (alternativa k chromadb)."
        },
        {
          "type": "heading",
          "text": "CLI pr√≠kazy"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "# Indexov√°n√≠\nagent index                          # cel√Ω workspace (mtime cache)\nagent index --project dashboard      # jen jeden projekt\nagent index --diff                   # jen git-changed soubory (git diff HEAD)\nagent index --force                  # ignoruj mtime, p≈ôeindexuj v≈°e\nagent index --docs                   # indexuj i .md soubory\n\n# Vyhled√°v√°n√≠\nagent search \"retry logika\"\nagent search \"z√°loha borg archiv\" --project backup-dashboard\nagent search \"WebSocket rooms\"  --top 10\nagent search \"co projekt dƒõl√°\" --scope docs    # hled√° v .md souborech"
        },
        {
          "type": "heading",
          "text": "Chunking strategie"
        },
        {
          "type": "table",
          "headers": ["Typ souboru", "Strategie", "Chunk ="],
          "rows": [
            [".py", "Per definice", "jedna 'def' nebo 'class'"],
            [".md", "Per sekce", "jeden '#' nebo '##' nadpis"],
            ["ostatn√≠", "Sliding window", "60 ≈ô√°dk≈Ø, 10 overlap"]
          ]
        }
      ]
    },
    {
      "id": "docs_pipeline",
      "title": "Docs pipeline",
      "icon": "üìÑ",
      "blocks": [
        {
          "type": "text",
          "text": "AI generuje <code>docs/data/{projekt}.json</code> (data-only), <code>build.py</code> renderuje HTML p≈ôes Jinja2 (bez AI). T√≠m se dramaticky sni≈æuj√≠ n√°klady ‚Äî AI nemus√≠ generovat HTML."
        },
        {
          "type": "heading",
          "text": "P≈ô√≠kazy"
        },
        {
          "type": "code",
          "lang": "bash",
          "text": "python3 docs/build.py                              # v≈°echny projekty\npython3 docs/build.py --project backup-dashboard   # jen jeden\npython3 docs/build.py --check                      # jen validace JSON\npython3 docs/build.py --force                      # ignoruj hash cache\npython3 docs/build.py --output /cesta/soubor.html  # vlastn√≠ v√Ωstup"
        },
        {
          "type": "card",
          "variant": "info",
          "title": "Kl√≠ƒçov√© pravidlo",
          "text": "Pole pro seznam polo≈æek v JSON bloc√≠ch se naz√Ωv√° 'entries' (nikoli 'items' ‚Äî items je Pythonova dict metoda a Jinja2 ji zachyt√≠ jako getattr d≈ô√≠ve ne≈æ dict kl√≠ƒç)."
        }
      ]
    },
    {
      "id": "persistence",
      "title": "Persistence pamƒõti",
      "icon": "üíæ",
      "blocks": [
        {
          "type": "text",
          "text": "T≈ô√≠vrstv√Ω syst√©m zachov√°vaj√≠c√≠ kontext nap≈ô√≠ch seseionami a model≈Ø. ≈òe≈°en√≠ probl√©mu ztr√°ty kontextu po odhl√°≈°en√≠ z Claude Code."
        },
        {
          "type": "heading",
          "text": "Jak funguje"
        },
        {
          "type": "text",
          "text": "Jsou 3 vrstvy: (1) <code>CLAUDE.md</code> ‚Äî master pravidla s Golden Rule (versioned v git), (2) <code>memory/</code> adres√°≈ô ‚Äî volatile session state auto-naƒç√≠tan√Ω Claudem, (3) <code>MODEL.md</code> ‚Äî handoff dokument pro AI (versioned v git)."
        },
        {
          "type": "heading",
          "text": "Sign√°ln√≠ fr√°ze: 'konec zvonec'"
        },
        {
          "type": "text",
          "text": "Kdy≈æ u≈æivatel nap√≠≈°e <code>konec zvonec</code>, jak√Ωkoliv model (Haiku/Sonnet/Opus) ti≈°e:"
        },
        {
          "type": "list",
          "ordered": true,
          "entries": [
            "Aktualizuje ~/.claude/projects/*/memory/MEMORY.md (aktu√°ln√≠ √∫kol + posledn√≠ akce + next steps)",
            "P≈ôid√° z√°znam do MODEL.md SESSION LOG",
            "Commitne + pushne: git add MODEL.md && git commit && git push gitea main && git push github main",
            "Nap√≠≈°e: 'V≈°e synchronizov√°no ‚Äî m≈Ø≈æe≈° se odhl√°sit.'"
          ]
        },
        {
          "type": "heading",
          "text": "Pr√≠≈°t√≠ session"
        },
        {
          "type": "text",
          "text": "Nov√Ω model (jak√Ωkoliv) se p≈ôihl√°s√≠ ‚Üí Claude Code auto-naƒçte MEMORY.md ‚Üí model vid√≠ co se dƒõlalo ‚Üí pokraƒçuje bez ztr√°t."
        },
        {
          "type": "heading",
          "text": "Soubory a jejich role"
        },
        {
          "type": "table",
          "headers": ["Soubor", "Um√≠stƒõn√≠", "Role", "Kdo p√≠≈°e"],
          "rows": [
            ["CLAUDE.md", "/home/geo/projects/", "Master pravidla + golden rule", "Developer + AI"],
            ["MEMORY.md", "~/.claude/projects/.../memory/", "Volatile session state", "Jak√Ωkoliv model"],
            ["session.md", "~/.claude/projects/.../memory/", "Detailn√≠ session log", "Jak√Ωkoliv model"],
            ["MODEL.md", "/home/geo/projects/", "AI handoff + architektura", "Jak√Ωkoliv model"]
          ]
        },
        {
          "type": "heading",
          "text": "Praktick√Ω p≈ô√≠klad"
        },
        {
          "type": "code",
          "lang": "text",
          "text": "Session 1: Sonnet pracuje na dokumentaci\n  ‚Üì 'konec zvonec'\n  ‚Üí MEMORY.md: 'Ps√°li jsme sekci Token Tracker, zb√Ωv√° Routing'\n  ‚Üí MODEL.md: 'Sonnet #4 ‚Äî dokumentace AI projektu'\n\nSession 2: Haiku se p≈ôihl√°s√≠\n  ‚Üì MEMORY.md auto-load\n  ‚Üì Haiku vid√≠: 'Pokraƒçuj v sekci Routing'\n  ‚úì Bezpeƒçnƒõ navazuje bez ztr√°t\n\nSession 3: Sonnet se vr√°t√≠\n  ‚Üì MEMORY.md st√°le zde\n  ‚Üì Vid√≠ co Haiku udƒõlal\n  ‚úì Pokraƒçuje d√°l"
        },
        {
          "type": "card",
          "variant": "warning",
          "title": "‚ö†Ô∏è Zlat√© pravidlo",
          "text": "P≈òED KONCEM JAK√âKOLIV SESSION ≈ôekni 'konec zvonec'. Bez tohoto kroku = kontext nav≈ædy ztracen."
        }
      ]
    },
    {
      "id": "faq",
      "title": "FAQ",
      "icon": "‚ùì",
      "blocks": [
        {
          "type": "heading",
          "text": "Ot√°zka: Kter√Ω model bych mƒõl jakou operaci d√°t?"
        },
        {
          "type": "text",
          "text": "Haiku: dokumentace, AI pipeline. Sonnet: v√Ωvoj, architektura, struktura, k√≥d. Opus: dlouh√© anal√Ωzy, komplexn√≠ architektura. Model routing v token_tracker.py to rozhoduje automaticky."
        },
        {
          "type": "heading",
          "text": "Ot√°zka: Jak se p≈ôihl√°s√≠m bez ztr√°ty kontextu?"
        },
        {
          "type": "text",
          "text": "≈òekni 'konec zvonec' P≈òED odhl√°≈°en√≠m. J√° to ulo≈æ√≠m. P≈ô√≠≈°tƒõ kdy≈æ se p≈ôihl√°s√≠≈°, MEMORY.md bude tu a j√° hned v√≠mu co se dƒõlalo."
        },
        {
          "type": "heading",
          "text": "Ot√°zka: Kolik mƒõ to bude st√°t?"
        },
        {
          "type": "text",
          "text": "Levn√© operace jdou na Ollama (zdarma). Drah√© na Claude. Bƒõ≈æ 'agent billing' a vid√≠≈° p≈ôesnou anal√Ωzu. Prompt cache (24h TTL) u≈°et≈ô√≠ pen√≠ze na opakovan√© dotazy."
        },
        {
          "type": "heading",
          "text": "Ot√°zka: Co kdy≈æ se mi cache nehod√≠?"
        },
        {
          "type": "text",
          "text": "Operace 'code_review' a 'architecture' maj√≠ TTL=0 (cache vypnut√Ω). Pro ostatn√≠ m≈Ø≈æe≈° upravit CACHE_TTL v token_tracker.py."
        },
        {
          "type": "heading",
          "text": "Ot√°zka: Jak najdu starou session?"
        },
        {
          "type": "text",
          "text": "MODEL.md SESSION LOG obsahuje v≈°echny session od zaƒç√°tku. Nebo bƒõ≈æ 'agent log --project X' a vid√≠≈° SQL z√°pisy. Archiv: 'tools/sanitize.py --target sessions' pro star≈°√≠ logy."
        }
      ]
    }
  ]
}
